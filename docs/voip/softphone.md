# Общая информация о софтфонах

Список софтфонов и инструкции по их настройке к freeswitch с tls.

## Оговорки

Для успешных звонков с телефона на вашем мобильном устройстве обязательно должен быть доступ в Интернет: Wifi, 3G, 4G.
Если ничего из предложенного вам не подошло, используйте размещенную ниже информацию для самостоятельной настройки приложений или оборудования, например, телефонов Yealink.
Все используемые приложения в современных версиях мобильных операционых систем имеют недостатки, выгружаются периодически из памяти, что не позволяет принять входящий вызов.
Пожалуйста, проявите терпение, попробуйте другую программу или используйте существующую преимущественно для исходящих вызовов.

## Подключение

Для подключения необходима действующая учетная запись: номер, пароль. Параметры для настройки клиента следующие:

* Сервер регистрации или домен - `yourdomain`
* Протокол подключения - `TLS`.
* Сервер STUN - `yourdomain`

При наличии проблем используйте следующие параметры:

* Сервер регистрации или домен - `yourdomain`
* Протокол подключения - `TCP`.
* Сервер STUN - `yourdomain`
* Время регистрации уменьшить до 300 секунд. Этот параметр может назвываться "Истекает" или "Окончание" и в качестве значения там может быть 3600 секунд или меньше.


## Учетная запись
При наличии в клиенте имени пользователя и имени авторизации данные о номере ввести в поле имя пользователя, а имя авторизации оставить пустым. Имя пользователя - это телефонный номер. Пароль состоит из различных символов в целях безопасности.
## Сервер регистрации
В разных клиентах возможны различные названия для обозначения, например, registar или  domain/домен.
## Протокол подключения
В целях безопасности допускается подключение по протоколу TLS на стандартный для данного подключения порт 5061.
## Сервер STUN
Большинство подключений к сервисам в сети Интернет осуществляются через домашние маршрутизаторы с включенной трансляцией адресов или через маршрутизаторы сотовых операторов. Для корректной передачи "голоса" на ваше устройство необходимо в настройках обязательно указывать адрес STUN сервера.
## Шифрование звонков
Поддерживается шифрование "голоса" протоколом SRTP, однако шифрование должно быть опциональной настройкой. Шифрование сигнализации осуществляется протоколом TLS всегда.
## Проверка микрофона
Позвоните на номер `*9195` и скажите несколько слов. Вы услышите запись ваших слов с задержкой в несколько секунд.

# Софтфоны в Android

На разных моделях телефонах какие-то приложения работают, а какие-то нет. Если у вас есть проблемы с одной программой, попробуйте поставить другую. Наиболее часто проблемы наблюдаются у пользователей телефонов Xiaomi из-за агрессивной политики снижения энергопотребления смартфона. Если у вас Xiaomi, попробуйте Zoiper, потом Sipnetic, соблюдая все необходимые рекомендации.

## Sipnetic

Приложение [sipnetic](https://www.sipnetic.com/) поддерживает связь с сервисом атс, не содержит рекламы, бесплатного функционала достаточно для звонков.

* Установите приложение по ссылке [https://play.google.com/store/apps/details?id=com.sipnetic.app](https://play.google.com/store/apps/details?id=com.sipnetic.app).
* Запустите приложение. Откроется экран "Добавление учетной записи SIP", где одним из пунктов будет "Сканировать QR-код". Выберите его, отсканируйте код с картинки ниже. В нем содержится адрес атс, прокотол tls, адрес stun-сервера. Код сгенерить по информации с сайта разрабочика.
* После сканирования введите в форму пятизначный номер телефона и пароль. 
* В меню "Настройки" -> "Безопасность" необходимо отключить шифрование SRTP. Если не отключать, то при звонке возникнет ошибка <span style="color:red">"Неверная конфигурация кодеков"</span>.
* Включите автозапуск приложения при включении телефона в меню "Настройки" -> "Персонализация". Пункт "Автозапуск" в самом низу практически.
* Проконтролируйте статус успешной регистрации в панели уведомлений. Должно быть "Зарегистрирован (<span style="color:green">**TLS**</span>)".
* Если иконка программы в панели не присутствует при блокировке телефона, то входящий вызов принять не получится и вам необходимо приобрести одно из платных приложений. Для начала попробуйте запретить удаления программы из памяти. В телефонах xiaomi нажмите левую нижную кнопку для вывода списка запущенных приложений. Удерживая приложение sipnetic, дождитесь появления иконки замка и выберите его. Следуйте инструкции [Настройка Sipnetic в Xiaomi](http://www.yourdomain/sipnetic_xiaomi.pdf). В прочих телефонах может быть похожая процедура. Нажмите кнопку для вывода списка приложений. Выберите символ, обозначающий действие Pin(закрепить) для приложения.
* Позвоните на номер `*9195` и скажите несколько слов. Вы услышите запись ваших слов с задержкой в несколько секунд. На некоторых моделях xiaomi может не работать микрофон. Перейдите в меню "Персонализация" -> "Расширенные настройки audio". Конфигурация микрофона должна быть "Voice recognition", а не "Voice communication".

## Linphone

* Установите Linphone из GooglePlay
* Если приложение настроить ранее не удалось, сотрите данные этого приложения на вашем телефоне через меню "Настройки" вашего телефона.
* При первом запуске будет предложено "создать аккаунт", "использовать аккаунт linphone", "**использовать sip-account**", "загрузить удаленную конфигурацию". Выберите "использовать sip-account"
* Заполните поля

 Поле | Значение 
---|---
Имя пользователя | пятизначный номер
Пароль | пароль
Домен | yourdomain

На этом же экране выберите транспорт TLS

* В меню нажмите на ваш номер и перейдите в настройки учетной записи.

 Поле | Значение 
---|---
Сервер STUN/TURN | yourdomain
Истекает | 300
Префикс | удалите все цифры, оставьте пустое поле

Наличие префикса приводит к ошибке Temporarily Unavailable. Посмотрите историю вызовов, где при наличие префикса к набранному номеру добавляется +7, например.
* Предоставьте запрашиваемые разрешения и внесите рекомендуемые изменения в режим "Не беспокоить" (DND). В Xiaomi это делается через меню Настройки => Приложения => Разрешения => Другие разрешения => Linphone => Разрешить всё , Настройки => Питание и производительность => Контроль активности => linphone => Нет ограничений. При первой попытке позвонить или принять вызов приложение выдаст сообщение "Разрешить приложению Linphone Записать звук? необходимо установить галочку "Больше не спрашивать" и нажать кнопку "Разрешить". 


## Zoiper

* Установите [Zoiper](https://play.google.com/store/apps/details?id=com.zoiper.android.app)
* Заполните форму и нажмите "create account"

 Поле | Значение 
---|---
Имя пользователя | логин@yourdomain
Пароль | пароль

* В поле имя хоста введите yourdomain
* Далее будет форма для ввода имени пользователя и пароля. Нажмите "Пропустить".
* Запустится тестирование конфигураций и будет автоматически выбран пункт SIP TLS или TCP или UDP. Нажмите "Конец".
* Предоставьте запрашиваемые разрешения и внесите рекомендуемые изменения в режим "Не беспокоить" (DND). В Xiaomi это делается через меню Настройки => Приложения => Разрешения=> Другие разрешения => Zoiper => Разрешить всё , Настройки => Питание и производительность => Контроль активности => Zoiper=> Нет ограничений.При первой попытке позвонить или принять вызов приложение выдаст сообщение "Разрешить приложению Zoiper Записать звук? необходимо установить галочку "Больше не спрашивать" и нажать кнопку "Разрешить". 



## Acrobits

Приложения для коммерческого использования платные. Вот рекомендуемый список приложений:

* [Acrobits Softphone](https://play.google.com/store/apps/details?id=cz.acrobits.softphone.alien)
* [Groundwire](https://play.google.com/store/apps/details?id=cz.acrobits.softphone.aliengroundwire) тот же Acrobits, но с конференциями и видео.

Ознакомьтесь с инструкцией по настройке приложения в ОС androin и ios [How To Make Acrobits Push Notifications Work In The Russian Federation](https://www.acrobits.net/blog/acrobits-push-in-russia/).

Добавление нового аккаунта

 Поле | Значение 
---|---
Название | myphone
Имя пользователя | номер
Пароль | пароль
Домен | yourdomain

Расширенные настройки

 Пункт меню | Значение 
---|---
Входящие звонки | Push-уведомления
Транспортный протокол | tls(sip)

Расширенные настройки - Обход NAT

 Поле | Значение 
---|---
Сервер STUN | yourdomain

Расширенные настройки - Push options

 Поле | Значение 
---|---
Хост SIPIS | ru.sipis.acrobits.cz
Регистратор SIPIS | ru.sipis.acrobits.cz
Длина префикса SIPIS | 0

Позвоните на номер `*9195` и скажите несколько слов. Вы услышите запись ваших слов с задержкой в несколько секунд.

При проблемах с исходящей связью необходимо перейти в меню "настройки", "учетные записи", "расширенные настройки".
Там будут пункты про кодеки для wifi и мобильной сети. Перетащите все, кроме G711 A-law, в секцию "Отключенные".

# Софтфоны в iOS

Необходимо понимать, что начиная с 11 версии iOS, все приложения ip-телефонии не работают, когда неактивны. Если телефон заблокировать, то через пару минут нельзя будет принять входящий вызов. Поэтому в Zoiper есть Premium функионал Push-ей. Без него можно пользоваться исходящей связью, участвовать в АКС. Push'и в Zoiper доступны по подписке, а клиента Acrobits можно купить один раз и push'и будут работать. Пока ваше приложение не работает, на атс регистрируется сервер Acrobits.

## Zoiper

Установите программу Zoiper Lite. С ее помощью вы сможете осуществлять только исходящие звонки, участвовать в АКС.

* Разрешите доступ приложения к микрофону при первом запуске.
* В меню "Настройки" - "Учетные записи" нажмите знак "+" для добавления учетной записи.
* На вопрос "У вас уже есть учетная запись (имя пользователя и пароль)?" нажмите "Да"
* Выберите "Ручная настройка"
* Выберите тип учетной записи "Учетная запись SIP"
* В основной форме "Параметры SIP" заполнить данные

Поле | Значение
---|---
Учетная запись | myphone (можно что угодно написать)
Домен | yourdomain
Имя пользователя | пятизначный номер
Пароль | ваш пароль

* Дополнительные настройки 

Поле | Значение
---|---
Имя авторизации | пусто (не заполнять)
Исходящий прокси | не включать
Исходящий прокси | пусто (не заполнять)

Уже на этом этапе можно нажать кнопку регистрация и проверить корректность введенных учетных данных. Если ошибка в пароле, то напишет Forbidden. Проверьте, что количество символов в поле пароль совпадает с количеством символов в пашем пароле. При наличии нечитаемым символов лучше запросите смену пароля. Дальшейшая настройка возможна при отмене регистрации. Для этого нажмите пункт настройки и выберите "Отменить регистрацию". 

* Дополнительные настройки - Настройки сети - Транспорт. Отключить IPv6. Вместо UDP выбрать TLS и на вопрос "Активировать опцию rport - сигнальный?" нажать "Да"
* Дополнительные настройки - Настройки сети - NAT.

Поле | Значение
---|---
Включить STUN | Вкллючено ( по умолчанию включено)
Сервер | yourdomain

Нажмите "Сохранить" в верхнем правом углу.

* Дополнительные настройки - Аудиокодеки. Отключить все кодеки, кроме a-law.
* Нажмите зеленую кнопку "Зарегистрировать".

## Acrobits

[https://www.acrobits.net/sip-client-ios-android/](https://www.acrobits.net/sip-client-ios-android/) доступные ссылки на скачивание приложений для Android и ios.
Groundwire отличается от Acrobits Softphone наличием конфиренций и переадресацией.
Ознакомьтесь с инструкцией по настройке приложения в ОС android и ios [How To Make Acrobits Push Notifications Work In The Russian Federation](https://www.acrobits.net/blog/acrobits-push-in-russia/).

Добавление нового аккаунта

 Поле | Значение 
---|---
Название | myphone
Имя пользователя | номер
Пароль | пароль
Домен | yourdomain

Расширенные настройки

 Пункт меню | Значение 
---|---
Входящие звонки | Push-уведомления
Транспортный протокол | tls(sip)

Расширенные настройки - Обход NAT

 Поле | Значение 
---|---
Сервер STUN | yourdomain

Расширенные настройки - Push options

 Поле | Значение 
---|---
Хост SIPIS | ru.sipis.acrobits.cz
Регистратор SIPIS | ru.sipis.acrobits.cz
Длина префикса SIPIS | 0

Позвоните на номер `*9195` и скажите несколько слов. Вы услышите запись ваших слов с задержкой в несколько секунд.

При проблемах с исходящей связью необходимо перейти в меню "настройки", "учетные записи", "расширенные настройки".
Там будут пункты про кодеки для wifi и мобильной сети. Перетащите все, кроме G711 A-law, в секцию "Отключенные".

# Софтфоны на ПК

## MicroSIP

Приложение [Microsip](https://www.microsip.org/) бесплатное и не требует прав администратора в процессе установки.
